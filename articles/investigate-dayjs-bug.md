---
title: "dayjsã®tzã®ãƒã‚°ã‚’èª¿ã¹ã¦ã¿ãŸ"
emoji: "ğŸ•"
type: "tech"
topics: ['dayjs', 'javascript']
published: false
publication_name: "backtech"
---
# æ°—ã«ãªã‚‹æŒ™å‹•
tzã¨startOfã‚’çµ„ã¿åˆã‚ã›ã‚‹ã¨ã€ç‰¹å®šã®TZã¨ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚±ãƒ¼ãƒ«ã®çµ„ã¿åˆã‚ã›ã§ã€æƒ³å®šå¤–ã®å‹•ãã‚’ã™ã‚‹ã“ã¨ã«æ°—ã¥ãã¾ã—ãŸã€‚
ä»¥ä¸‹ã€ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚±ãƒ¼ãƒ«ã¯ã™ã¹ã¦æ—¥æœ¬æ™‚é–“ã¨ã—ã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰
```typescript
import dayjs from 'dayjs';
import timezone from 'dayjs/plugin/timezone.js';
import utc from 'dayjs/plugin/utc.js';

dayjs.extend(utc);
dayjs.extend(timezone);

const now = dayjs('2024-02-11 07:00:00+09');
const abidjanNow = now.tz('Africa/Abidjan').format();
const abidjanStartOfDay = now.tz('Africa/Abidjan').startOf('day').format();

console.table({ abidjanNow, abidjanStartOfDay });
```

çµæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (index)           â”‚ Values                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ abidjanNow        â”‚ '2024-02-10T22:00:00Z'      â”‚
â”‚ abidjanStartOfDay â”‚ '2024-02-09T15:00:00Z'      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
abidjanStartOfDayãŒäºˆæƒ³ã§ã¯`2024-02-10T00:00:00Z`ã«ãªã‚‹ã¨æ€ã£ãŸã®ã§ã™ãŒã€ç•°ãªã‚Šã¾ã™ã€‚
ã¡ãªã¿ã«momentjsã ã¨äºˆæƒ³ã©ãŠã‚Š`2024-02-10T00:00:00Z`ã«ãªã‚Šã¾ã™ã€‚

# åŸå› ã‚’æ¢ã‚‹
githubã«é–¢é€£ã™ã‚‹issueãŒä½•å€‹ã‹æŒ™ãŒã£ã¦ã„ã¾ã—ãŸã€‚ã„ãšã‚Œã‚‚è§£æ±ºã—ã¦ãªã„ã‚ˆã†ã§ã™ã€‚
ä¼‘æ—¥ã«æš‡ã ã£ãŸã®ã§ã€åŸå› ã‚’æ¢ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§startOfã®å®Ÿè£…ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚
ãƒªãƒ³ã‚¯ã¯ã“ã¡ã‚‰ã§ã™ã€‚(åŸ·ç­†æ™‚ç‚¹ã§ã®æœ€æ–°ã®v1.11.0ã§ã™)
https://github.com/iamkun/dayjs/blob/e56a8703dcc3820196972f53990010daf248726b/src/plugin/timezone/index.js#L118-L126

ã“ã®ä¸­ã§æ€ªã—ã„ã®ã¯ã€125è¡Œç›®ã®`startOfWithoutTz.tz(this.$x.$timezone, true)`ã§ã™ã­ï¼
(å®Ÿã¯åœ°é“ã«ãƒ­ã‚°ã‚’ä»•è¾¼ã‚“ã ã‚Šã€node inspectä½¿ã£ã¦2hãã‚‰ã„ãƒ‡ãƒãƒƒã‚°ã—ã¦ã„ã¾ã—ãŸã€‚ã€‚ã€‚)

tz()ã®ç¬¬ï¼’å¼•æ•°ã¯keepLocalTimeã§ã™ã€‚ã“ã‚Œã¯ä¾‹ãˆã°
```typescript
console.log(dayjs().format());
console.log(dayjs().tz('Asia/Ho_Chi_Minh', true).format());
// 2024-02-11T07:00:00+09:00
// 2024-02-11T07:00:00+07:00 <--
```
ã“ã‚“ãªæ„Ÿã˜ã§ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³éƒ¨åˆ†ã ã‘ã‚’å¤‰ãˆãŸã„ã‚±ãƒ¼ã‚¹ã§ä½¿ã„ã¾ã™ã€‚

è©¦ã—ã«å•é¡Œã®tzã§å¤‰æ›ã‚’ã—ã¦ã¿ã¾ã™ã€‚
```typescript
console.log(dayjs('2024-02-11 07:00:00+09').tz('Africa/Abidjan', true).format());
// 2024-02-10T22:00:00Z
```

`2024-02-11T07:00:00Z`ã«ãªã‚‰ãªã„ã§ã™ã€‚ã¾ãšã„ã§ã™ã­ã€‚
ãŸã å®Ÿã¯ã“ã‚Œã€toDateã®çµæœã¯æ­£ã—ã„ã‚“ã§ã™ã€‚
```typescript
console.log(dayjs('2024-02-11 07:00:00+09').tz('Africa/Abidjan', true).toDate().toISOString())
// 2024-02-11T07:00:00.000Z
```
ã¤ã¾ã‚Šformatã«ä½•ã‹ã—ã‚‰å•é¡Œã‚ã‚Šãã†ã¨ã„ã†æ„Ÿã˜ã§ã™ã­ã€‚

ãªã‚“ã formatã®æŒ™å‹•ãŒãŠã‹ã—ã„ã ã‘ã‹ã€ã¨æ€ã£ãŸã‚‰ã€
```typescript
const abidjan = dayjs().tz('Africa/Abidjan');
console.log(abidjan.startOf('day').toDate().toISOString())
console.log(abidjan.startOf('day').startOf('day').toDate().toISOString())
console.log(abidjan.startOf('day').startOf('day').startOf('day').toDate().toISOString())
// 2024-02-10T00:00:00.000Z
// 2024-02-09T00:00:00.000Z
// 2024-02-08T00:00:00.000Z
```
startOfã—ã¦ã‚‹ã ã‘ãªã®ã«ã©ã‚“ã©ã‚“éå»ã«ãªã‚‹ãƒ»ãƒ»ãƒ»ã€‚
ã“ã‚Œã¯ã€å…ˆç¨‹ã®startOfã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®
https://github.com/iamkun/dayjs/blob/e56a8703dcc3820196972f53990010daf248726b/src/plugin/timezone/index.js#L118-L126
L123ã§formatã‚’ä½¿ã£ã¦ã‚‹ã‹ã‚‰ã§ã™ã­ã€‚

# æ—¢ã«è§£æ±ºã™ã‚‹PRãŒæŠ•ã’ã‚‰ã‚Œã¦ã„ãŸ
ã“ã“ã¾ã§èª¿ã¹ã¦ã€issueã‚’å†åº¦æ¼ã£ã¦ã„ã‚‹ã¨ã€
https://github.com/iamkun/dayjs/pull/2264

æ—¢ã«ä¿®æ­£ã™ã‚‹PRãŒä½œã‚‰ã‚Œã¦ã„ã¾ã—ãŸã€‚
ã©ã†ã‚„ã‚‰utcoffsetãŒ0ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³(Africa/Abidjanãªã©)ã®dayjsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ã€$u(utcãƒ•ãƒ©ã‚°)ãŒtrueã«ãªã£ã¦ã„ã‚‹ã“ã¨ã§ã€formatæ™‚ã«2é‡ã§offsetãŒå¼•ã‹ã‚ŒãŸã‚ˆã†ãªå‹•ä½œã«ãªã£ã¦ã‚‹ã¿ãŸã„ã§ã™ã€‚

æ—©ããƒãƒ¼ã‚¸ã—ã¦ã»ã—ã„ã§ã™ã­ã€‚

:::details tzå‡¦ç†å¾Œã®Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦ä½™è«‡
æœ¬æ¥tzã§å‡¦ç†ã—ãŸdayjsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå€¤ã‚’ã‚‚ã£ã¦ã„ã¾ã™ã€‚
```typescript
dayjs('2024-02-11 00:00:00Z').tz("Africa/Abidjan")
/*
M {
  '$L': 'en',
  '$d': 2024-02-10T15:00:00.000Z,
  '$y': 2024,
  '$M': 1,
  '$D': 11,
  '$W': 0,
  '$H': 0,
  '$m': 0,
  '$s': 0,
  '$ms': 0,
  '$x': { '$timezone': 'Africa/Abidjan' },
  '$isDayjsObject': true,
  '$offset': 0,
  '$u': true
}
*/
```
$dã«dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ ¼ç´ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€9æ™‚é–“ã‚ºãƒ¬ã¦ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã­ã€‚
ã—ã‹ã—ã“ã‚Œã¯å•é¡Œãªã„ã§ã™ã€‚å®Ÿéš›ã«formatã™ã‚‹éš›ã«ã¯`$D`(æ—¥ã«ã¡), `$H`(æ™‚é–“)ãªã©ãŒä½¿ã‚ã‚Œã€`$d`ã®å€¤ã¯å‚ç…§ã•ã‚Œãªã„ã§ã™ã€‚
ã¾ãŸã€valueOfã§unixæ™‚é–“ã‚’å‡ºåŠ›ã™ã‚‹ã¨ãã«ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚±ãƒ¼ãƒ«ã¨ã®å·®åˆ†ãŒè¶³ã•ã‚Œã‚‹ã“ã¨ã§ã€æ­£ã—ã„å€¤ã«ãªã‚Šã¾ã™ã€‚

formatã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ä¿ã¤ãŸã‚ã«ã“ã‚“ãªå®Ÿè£…ãªã®ã‹ãªã¨æ€ã„ã¾ã™ãŒã€ã“ã®ã›ã„ã§ã ã„ã¶æ··ä¹±ã—ã¾ã—ãŸã€‚ã€‚ã€‚
<!-- https://github.com/iamkun/dayjs/blob/e56a8703dcc3820196972f53990010daf248726b/src/plugin/utc/index.js#L115-L119 -->
<!-- `this.$d.getTimezoneOffset()`ãŒä¾‹ãˆã°ä¸Šã®ä¾‹ã ã¨-540(9æ™‚é–“)ã«ãªã‚‹ã€‚ -->
:::

:::details formatæ™‚ã«2é‡ã§offsetãŒå¼•ã‹ã‚Œã‚‹ã¨ã¯ï¼Ÿ
formatæ™‚ã«2é‡ã§offsetãŒå¼•ã‹ã‚Œã‚‹ã¨ã„ã†ã®ã¯æ­£ç¢ºã«è¨€ã„ç›´ã™ã¨ã€tzå‡¦ç†å¾Œã«cloneã—ãŸæ™‚ç‚¹ã§ã€isUtcãŒtrueã®å ´åˆã¯ã€`$H`ãªã©ã«`$d.getUTCHours()`ã§utcã«å¤‰æ›ã•ã‚ŒãŸå€¤ãŒä»£å…¥ã•ã‚Œã¾ã™ã€‚
https://github.com/iamkun/dayjs/blob/e56a8703dcc3820196972f53990010daf248726b/src/plugin/utc/index.js#L55-L69
ãã†ã™ã‚‹ã¨ã€æœ¬æ¥ã¯$d.getHours()ã§ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚±ãƒ¼ãƒ«ã¨ã®å·®åˆ†ã‚’è€ƒæ…®ã—ã¦ä»£å…¥ã•ã‚Œã‚‹ã¨ã“ã‚ãŒã€utcã«ãªã£ã¦ã—ã¾ã„ã€ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚±ãƒ¼ãƒ«ã¨utcã®å·®åˆ†ã®åˆ†ãŒã‚ºãƒ¬ã¦ã—ã¾ã„ã¾ã™ã€‚

ã¤ã¾ã‚Šä¸Šã®ä¾‹ã‚’æ›´ã«cloneã™ã‚‹ã¨ã€
```typescript
dayjs('2024-02-11 00:00:00Z').tz("Africa/Abidjan").clone()
/*
M {
  '$L': 'en',
  '$d': 2024-02-10T15:00:00.000Z,
  '$y': 2024,
  '$M': 1,
  '$D': 10,
  '$W': 6,
  '$H': 15, $d.getUTCHours()ã§å–å¾—ã—ãŸå€¤ã€‚ã“ã‚ŒãŒformatã«ä½¿ã‚ã‚Œã‚‹ã€‚
  '$m': 0,
  '$s': 0,
  '$ms': 0,
  '$x': { '$timezone': 'Africa/Abidjan' },
  '$isDayjsObject': true,
  '$offset': 0,
  '$u': true
}
*/
```
```typescript
dayjs('2024-02-11 00:00:00Z').tz("Africa/Abidjan").clone().format()
// 2024-02-10T15:00:00Z
```
:::